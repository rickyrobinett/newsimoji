import{Router as A}from"itty-router";class e extends Error{key;constructor(A){super(A),this.message=A}}class t extends e{constructor(A){super(A)}}class r{static isParameter=!0;isParameter=!0;type="string";params;generated;constructor(A){this.params=A||{},this.generated=!0,void 0===this.params.required&&(this.params.required=!0)}getValue(){const A={type:this.type,description:this.params.description,example:this.params.example,default:this.params.default};return this.params.deprecated&&(A.deprecated=this.params.deprecated),A}validate(A){return A}}class n extends r{isArr=!0;innerType;constructor(A,e){super(e),this.innerType=A}validate(A){return A=super.validate(A),!1!==this.params.required||null!==A&&""!==A?A=Array.isArray(A)?A.map((A=>this.innerType.validate(A))):[this.innerType.validate(A)]:null}getValue(){return{type:"array",items:this.innerType.getValue(),description:this.params.description,example:this.params.example,default:this.params.default}}}class a extends r{isObj=!0;fields;constructor(A,e){super(e),this.fields=A}validate(A){A=super.validate(A);for(const[e,r]of Object.entries(this.fields))try{if(void 0===A[e]||null===A[e]){if(r.params.required)throw new t("is required")}else A[e]=r.validate(A[e])}catch(A){throw A.key=(A.key||"")+`.${e}`,A}return A}getValue(){const A={type:"object",properties:{}},e=[];for(const[t,r]of Object.entries(this.fields))!0===r.params?.required&&e.push(t),r.getValue?A.properties[t]=r.getValue():A.properties[t]=r;return e.length>0&&(A.required=e),this.params.xml&&(A.xml=this.params.xml),A}}class s extends r{type="number";validate(A){if(A=super.validate(A),A=Number.parseFloat(A),isNaN(A))throw new t("is not a valid number");return A}}class i extends r{type="string";constructor(A){super(A)}validate(A){if("string"!=typeof(A=super.validate(A))&&(A=A.toString()),this.params.format)if("date-time"===this.params.format){if(A=new Date(A),isNaN(A.getDay()))throw new t("is not a valid date time")}else if("date"===this.params.format){if(!A.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/))throw new t("is not a valid date");if(A=new Date(A),isNaN(A.getDay()))throw new t("is not a valid date")}return A}getValue(){return{...super.getValue(),format:this.params.format}}}class o extends i{type="string";constructor(A){super({example:"2022-09-15T00:00:00Z",...A,format:"date-time"})}}class p extends i{type="boolean";validValues=["true","false"];validate(A){if(A=(A=super.validate(A)).toLowerCase(),!this.validValues.includes(A))throw new t("is not a valid boolean, allowed values are true or false");return A="true"===A}}class l{location;rawType;type;params;constructor(A,e,t){this.location=A,this.rawType=e,void 0===t.required&&(t.required=!0),this.params=t,this.type=this.getType(e,t)}getType(A,e){if(!0===A.generated)return A;if(!0===A.isParameter)return new A({...e});if(A===String)return new i({...e});if("string"==typeof A)return new i({example:A});if(A===Number)return new s({...e});if("number"==typeof A)return new s({example:A});if(A===Boolean)return new p({...e});if("boolean"==typeof A)return new p({example:A});if(A===Date)return new o;if(Array.isArray(A)){if(0===A.length)throw new Error("Arr must have a type");return new n(this.getType(A[0],e),{...e})}if("object"==typeof A){const t={};for(const[e,r]of Object.entries(A))t[e]=this.getType(r,{});return new a(t,e)}throw new Error(`${A} not implemented`)}getValue(){const A=u(this.type.getValue());return{description:this.params.description,required:this.params.required,schema:A,name:this.params.name,in:this.location}}validate(A){if(null==A){if(void 0===this.params.default||null===this.params.default){if(this.params.required)throw new t("is required");return null}A=this.params.default}return A=this.type.validate(A)}}function u(A){for(const[e,t]of Object.entries(A))"object"!=typeof t||Array.isArray(t)||(A[e]=u(t)),void 0===t&&delete A[e];return A}function f(A){const e=[],t=Array.isArray(A);for(const[r,n]of Object.entries(A||{})){if(t&&!n.params.name)throw new Error("Parameter must have a defined name when using as Array");const A=n.params.name?n.params.name:r;e.push({...n.getValue(),name:A})}return e}var d,c,h;function m(e){const t={},r=A({base:e?.base,routes:e?.routes}),n={openapi:"3.0.2",info:{title:e?.schema?.info?.title||"OpenAPI",version:e?.schema?.info?.version||"1.0"},raiseUnknownParameters:e?.raiseUnknownParameters,...e?.schema},a={...n,paths:t};delete a.raiseUnknownParameters;const s=new Proxy(r,{get:(A,s,i)=>"original"===s?r:"schema"===s?a:(r,...a)=>{if("handle"!==s)if(1===a.length&&void 0!==a[0].schema?.paths){const A=a[0];for(const[e,r]of Object.entries(A.schema.paths))t[e]=r}else if("all"!==s){const A=(e?.base||"")+r.replace(/\/+(\/|$)/g,"$1").replace(/:(\w+)/g,"{$1}");let n,i;for(const A of a)if(A.name&&(i=`${s.toString()}_${A.name}`),A.getParsedSchema){n=A.getParsedSchema();break}if(void 0===t[A]&&(t[A]={}),void 0===i&&(i=`${s.toString()}_${r.replaceAll("/","_")}`),void 0===n){const A=r.match(/:(\w+)/g);n={operationId:i,parameters:A?f(A.map((A=>function(A,e={}){return new l("path",A,e)}(String,{name:A.replace(":","")})))):[],responses:{200:{description:"Successfully Response"}}}}else if(!n.operationId){if(!1===e?.generateOperationIds&&!n.operationId)throw new Error(`Route ${r} don't have operationId set!`);n.operationId=i}t[A][s.toString()]=n}return Reflect.get(A,s,i)(r,...a.map((A=>void 0!==A.schema?.paths?A.handle:A.isRoute?(...e)=>new A({raiseUnknownParameters:n.raiseUnknownParameters}).execute(...e):A)))}});return void 0!==n&&(null!==e?.docs_url&&null!==e?.openapi_url&&r.get(e?.docs_url||"/docs",(()=>new Response(`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1"/>\n    <meta name="description" content="SwaggerIU"/>\n    <title>SwaggerUI</title>\n    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui.css"/>\n    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMb//2ux//9or///ZKz//wlv5f8JcOf/CnXv/why7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2vi/wZo3/9ytf//b7P//2uw//+BvP//DHbp/w568P8Md+//CnXv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApv4/8HbOH/lMf//3W3//9ytf//brL//w946v8SfvH/EHzw/w558P8AAAAAAAAAAAAAAAAAAAAAAAAAABF56f8Ndef/C3Dj/whs4f98u///eLn//3W3//+Evv//FoPx/xSA8f8SfvD/EHvw/wAAAAAAAAAAAAAAAA1EeF0WgOz/EXrp/w515v8LceT/lsn//3+9//97u///eLj//xaB7f8YhfL/FoLx/xSA8f8JP/deAAAAAAAAAAAgjfH/HIjw/xeB7P8Te+n/AAAAAAAAAACGwf//gr///369//+Iwf//HIny/xqH8v8YhfL/FYLx/wAAAAAnlfPlJJLy/yGO8v8cifD/GILt/wAAAAAAAAAAmMz//4nD//+Fwf//gb///xyJ8P8ejPP/HIny/xmH8v8XhPLnK5r0/yiW8/8lk/P/IpDy/wAAAAAAAAAAAAAAAAAAAACPx///jMX//4jD//+MxP//IpD0/yCO8/8di/P/G4ny/y6e9f8sm/T/KZj0/yaV8/8AAAAAAAAAAAAAAAAAAAAAlsz//5LJ//+Px///lMn//yaV9P8kkvT/IZD0/x+O8/8yo/blMKD1/y2d9f8qmfT/KJbz/wAAAAAAAAAAqdb//53Q//+Zzv//lsv//yiY8/8qmvX/KJf1/yWV9P8jkvTQAAAAADSl9v8xofX/Lp71/yyb9P8AAAAAAAAAAKfW//+k1P//oNL//6rW//8wofb/Lp72/yuc9f8pmfX/AAAAAAAAAAAcVHtcNab2/zKj9v8voPX/LZz0/7vh//+u2///qtj//6fW//8wofT/NKX3/zKj9/8voPb/F8/6XgAAAAAAAAAAAAAAADmr9/82qPf/M6T2/zCg9f+44f//td///7Hd//++4v//Oqz4/ziq+P81p/f/M6X3/wAAAAAAAAAAAAAAAAAAAAAAAAAAOqz4/zep9//M6///v+X//7vj//+44f//OKn1/z6x+f88rvn/Oaz4/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6x+f8qmfP/yOv//8bq///C5///z+z//0O3+v9Ctfr/QLP5/z2x+f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0u///8jr///I6///yOv//zmq9f9Dt/r/Q7f6/0O3+v8AAAAAAAAAAAAAAAAAAAAA8A8AAOAHAADgBwAAwAMAAMADAACGAQAABgAAAA8AAAAPAAAABgAAAIYBAADAAwAAwAMAAOAHAADgBwAA8A8AAA==" />\n</head>\n<body>\n<div id="swagger-ui"></div>\n<script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-bundle.js" crossorigin><\/script>\n<script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-standalone-preset.js" crossorigin><\/script>\n<script>\n    window.onload = () => {\n        window.ui = SwaggerUIBundle({\n            url: '${((e?.base||"")+(e?.openapi_url||"/openapi.json")).replace(/\/+(\/|$)/g,"$1")}',\n            dom_id: '#swagger-ui',\n            deepLinking: true,\n            presets: [\n                SwaggerUIBundle.presets.apis\n            ]\n        });\n    };\n<\/script>\n</body>\n</html>`,{headers:{"content-type":"text/html; charset=UTF-8"},status:200}))),null!==e?.redoc_url&&null!==e?.openapi_url&&r.get(e?.redoc_url||"/redocs",(()=>new Response(`<!DOCTYPE html>\n    <html>\n    <head>\n    <title>ReDocUI</title>\n    \x3c!-- needed for adaptive design --\x3e\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n\n    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700" rel="stylesheet">\n    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMb//2ux//9or///ZKz//wlv5f8JcOf/CnXv/why7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2vi/wZo3/9ytf//b7P//2uw//+BvP//DHbp/w568P8Md+//CnXv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApv4/8HbOH/lMf//3W3//9ytf//brL//w946v8SfvH/EHzw/w558P8AAAAAAAAAAAAAAAAAAAAAAAAAABF56f8Ndef/C3Dj/whs4f98u///eLn//3W3//+Evv//FoPx/xSA8f8SfvD/EHvw/wAAAAAAAAAAAAAAAA1EeF0WgOz/EXrp/w515v8LceT/lsn//3+9//97u///eLj//xaB7f8YhfL/FoLx/xSA8f8JP/deAAAAAAAAAAAgjfH/HIjw/xeB7P8Te+n/AAAAAAAAAACGwf//gr///369//+Iwf//HIny/xqH8v8YhfL/FYLx/wAAAAAnlfPlJJLy/yGO8v8cifD/GILt/wAAAAAAAAAAmMz//4nD//+Fwf//gb///xyJ8P8ejPP/HIny/xmH8v8XhPLnK5r0/yiW8/8lk/P/IpDy/wAAAAAAAAAAAAAAAAAAAACPx///jMX//4jD//+MxP//IpD0/yCO8/8di/P/G4ny/y6e9f8sm/T/KZj0/yaV8/8AAAAAAAAAAAAAAAAAAAAAlsz//5LJ//+Px///lMn//yaV9P8kkvT/IZD0/x+O8/8yo/blMKD1/y2d9f8qmfT/KJbz/wAAAAAAAAAAqdb//53Q//+Zzv//lsv//yiY8/8qmvX/KJf1/yWV9P8jkvTQAAAAADSl9v8xofX/Lp71/yyb9P8AAAAAAAAAAKfW//+k1P//oNL//6rW//8wofb/Lp72/yuc9f8pmfX/AAAAAAAAAAAcVHtcNab2/zKj9v8voPX/LZz0/7vh//+u2///qtj//6fW//8wofT/NKX3/zKj9/8voPb/F8/6XgAAAAAAAAAAAAAAADmr9/82qPf/M6T2/zCg9f+44f//td///7Hd//++4v//Oqz4/ziq+P81p/f/M6X3/wAAAAAAAAAAAAAAAAAAAAAAAAAAOqz4/zep9//M6///v+X//7vj//+44f//OKn1/z6x+f88rvn/Oaz4/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6x+f8qmfP/yOv//8bq///C5///z+z//0O3+v9Ctfr/QLP5/z2x+f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0u///8jr///I6///yOv//zmq9f9Dt/r/Q7f6/0O3+v8AAAAAAAAAAAAAAAAAAAAA8A8AAOAHAADgBwAAwAMAAMADAACGAQAABgAAAA8AAAAPAAAABgAAAIYBAADAAwAAwAMAAOAHAADgBwAA8A8AAA==" />\n\n    \x3c!--\n    ReDoc doesn't change outer page styles\n    --\x3e\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n      }\n    </style>\n    </head>\n    <body>\n    <redoc spec-url="${((e?.base||"")+(e?.openapi_url||"/openapi.json")).replace(/\/+(\/|$)/g,"$1")}"></redoc>\n    <script src="https://unpkg.com/redoc@2.0.0-rc.58/bundles/redoc.standalone.js"> <\/script>\n    </body>\n    </html>`,{headers:{"content-type":"text/html; charset=UTF-8"},status:200}))),null!==e?.openapi_url&&r.get(e?.openapi_url||"/openapi.json",(()=>new Response(JSON.stringify(a),{headers:{"content-type":"application/json;charset=UTF-8"},status:200}))),e?.aiPlugin&&null!==e?.openapi_url&&r.get("/.well-known/ai-plugin.json",(A=>{const t={type:h.OPENAPI,has_user_authentication:!1,url:e?.openapi_url||"/openapi.json",...e?.aiPlugin?.api};return t.url.startsWith("http")||(t.url=`https://${A.headers.get("host")}${t.url}`),new Response(JSON.stringify({schema_version:d.V1,auth:{type:c.NONE},...e?.aiPlugin,api:t}),{headers:{"content-type":"application/json;charset=UTF-8"},status:200})}))),s}!function(A){A.V1="v1"}(d||(d={})),function(A){A.NONE="none",A.OAUTH="oauth",A.SERVICE_HTTP="service_http",A.USER_HTTP="user_http"}(c||(c={})),function(A){A.OPENAPI="openapi"}(h||(h={}));export{m as OpenAPIRouter};
